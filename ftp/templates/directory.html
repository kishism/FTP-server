{% extends "base.html" %}
{% block content %}

<!-- 
  
   `Breadcrumb is currently broken`

<div class="file-breadcrumb">
  {% set parts = dirpath.split('/') if dirpath else [] %}
  {% set accumulated_paths = [] %}

  <a href="{{ url_for('directories.list_directory', dirpath='') }}" class="breadcrumb-link">root</a>

  {% for part in parts %}
      {% set accumulated_paths = accumulated_paths + [part] %}
      {% set full_path = accumulated_paths | join('/') %}
      <span class="breadcrumb-separator">/</span>
      {% if loop.last %}
          <span class="current">{{ part }}</span>
      {% else %}
          <a href="{{ url_for('directories.list_directory', dirpath=full_path) }}" class="breadcrumb-link">
              {{ part }}
          </a>
      {% endif %}
  {% endfor %}
</div> 
-->

<!-- Toolbar -->
<section class="toolbar">
  <!-- Create folder -->
  <form action="{{ url_for('directories.create_directory') }}" method="POST" class="toolbar-item">
    <input type="hidden" name="parent_dir" value="{{ dirpath if dirpath else '' }}">
    <input type="text" name="dirname" placeholder="New Folder Name" required title="Folder Name">
    <button type="submit" class="icon-btn" title="Create Folder">
      <span class="icon folder-icon"></span>
    </button>
  </form>

  <!-- Upload file -->
  <form action="{{ url_for('directories.upload_file', dirpath=dirpath if dirpath else '') }}" 
        method="POST" enctype="multipart/form-data" class="toolbar-item">
    <input type="file" name="file" id="upload-file" hidden onchange="this.form.submit()">
    <label for="upload-file" class="icon-btn" title="Upload File">
      <span class="icon file-upload-icon"></span>
    </label>
    <button type="submit" hidden></button>
  </form>

  <!-- Upload folder -->
  <form action="{{ url_for('directories.upload_folder', dirpath=dirpath if dirpath else '') }}"
        method="POST" enctype="multipart/form-data" class="toolbar-item">
    <input type="file" name="files" id="upload-folder" webkitdirectory multiple hidden onchange="this.form.submit()">
    <label for="upload-folder" class="icon-btn" title="Upload Folder">
      <span class="icon folder-upload-icon"></span>
    </label>
    <button type="submit" hidden></button>
  </form>
</section>

<h2>{{ dirpath }}/</h2>

<!-- Folder and file list -->
<ul class="file-list">
  {% for d in directories %}
    {% set child_path = (dirpath ~ '/' ~ d) if dirpath else d %}
    {% if child_path != dirpath %}
      <li class="folder">
        <a href="{{ url_for('directories.list_directory', dirpath=child_path) }}">
          <span class="file-icon folder-icon"></span>
          {{ d }}
        </a>
      </li>
    {% else %}
      <li class="folder current">
        <span class="file-icon folder-icon"></span>
        {{ d }}
      </li>
    {% endif %}
  {% endfor %}

  {% for f in files %}
    <li class="file">
      <a href="{{ url_for('directories.view_file', filepath=(dirpath ~ '/' ~ f.name) if dirpath else f.name) }}">
        <span class="file-icon {% if f.mime_type.startswith('image/') %}image-file-icon{% else %}regular-file-icon{% endif %}"></span>
        {{ f.name }}
      </a>
    </li>
  {% endfor %}
</ul>

{% endblock %}
